@startuml sd


participant PisoRoute as route
participant InterfacePisoController as ictrl
participant PisoController as ctrl
participant InterfacePisoService as isvc
participant PisoService as svc
participant InterfacePisoRepo as irepo
participant InterfaceEdificioRepo as ierepo
participant PisoRepo as repo
participant EdificioRepo as erepo
participant PisoMapper as mapper
participant InterfacePisoPersistence as ischema
participant PisoSchema as schema
participant EdificioMapper as emapper
participant InterfaceEdificioPersistence as ieschema
participant EdificioSchema as eschema
participant ConfigurationFile as conf


route -> ictrl++ : updatePiso(req,res,next)
route++
ictrl -> ctrl : updatePiso(req,res,next)
ctrl++
ctrl -> conf : injeta o serviço do piso
conf++
conf --> ctrl
conf--
ctrl -> isvc : updatePiso(pisoDTO)
isvc++
isvc -> svc : updatePiso(pisoDTO)
svc++
svc -> conf : injeta o repositório do piso
conf++
conf --> svc
conf--
svc -> conf : injeta o repositório do edificio
conf++
conf --> svc
conf--
svc -> irepo : findByDesignacao(designacao)
irepo++
irepo -> repo : findByDesignacao(designacao)
repo++
repo -> conf : injeta o schema dos pisos
conf++
conf --> repo
conf--
repo -> ischema : findOne(query)
ischema++
ischema -> schema : findOne(query)
schema++
schema --> ischema
schema--
ischema --> repo
ischema--
repo -> mapper : toDomain(pisoRecord)
mapper++
mapper --> repo
mapper--
repo--> irepo
repo--
irepo --> svc

svc -> ierepo : findByCodigo(edificio)
ierepo++
ierepo -> erepo : findByCodigo(edificio)
erepo++
erepo -> conf : injeta o schema dos edificios
conf++
conf --> erepo
conf--
erepo -> ieschema : findOne(query)
ieschema++
ieschema -> eschema : findOne(query)
eschema++
eschema --> ieschema
eschema--
ieschema --> erepo
ieschema--
erepo -> emapper : toDomain(edificioRecord)
emapper++
emapper --> erepo
emapper--
erepo--> ierepo
erepo--
ierepo --> svc
ierepo--

svc -> irepo: save(piso)

irepo -> repo :save(piso)
repo++
repo -> ischema : findOne(query)
ischema++
ischema -> schema : findOne(query)
schema++
schema --> ischema
schema--
ischema --> repo
alt cria piso
else atualiza piso
repo -> ischema
ischema -> schema : save()
schema++
schema --> ischema
schema--
ischema --> repo
ischema--
end
repo --> irepo
repo--
irepo --> svc
irepo--
svc -> mapper : toDTO(piso)
mapper++
mapper --> svc
mapper--
svc --> isvc 
svc--
isvc --> ctrl
isvc--
ctrl --> ictrl
alt caso de sucesso
    ctrl --> ictrl : Envia um código 201 (GET)
else caso de insucesso
    ctrl --> ictrl : Envia um código 404 (NOT FOUND)
end
ctrl--
ictrl --> route
